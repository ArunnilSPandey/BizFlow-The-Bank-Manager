(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3223:(e,a,t)=>{Promise.resolve().then(t.bind(t,8455))},8455:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ax});var s=t(5155),r=t(4659),n=t(2115),l=t(9434);let i=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});i.displayName="Card";let o=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});o.displayName="CardHeader";let d=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});d.displayName="CardTitle";let c=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});c.displayName="CardDescription";let m=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("p-6 pt-0",t),...r})});m.displayName="CardContent";let u=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})});u.displayName="CardFooter";var x=t(5977);let f=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(x.bL,{ref:a,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});f.displayName=x.bL.displayName;let p=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(x._V,{ref:a,className:(0,l.cn)("aspect-square h-full w-full",t),...r})});p.displayName=x._V.displayName;let h=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(x.H4,{ref:a,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});h.displayName=x.H4.displayName;var g=t(285),j=t(3638),b=t(9829),y=t(5821),N=t(2085),w=t(5318);let v=y.bL;y.l9,y.bm;let k=y.ZL,C=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.hJ,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a})});C.displayName=y.hJ.displayName;let D=(0,N.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),R=n.forwardRef((e,a)=>{let{side:t="right",className:r,children:n,...i}=e;return(0,s.jsxs)(k,{children:[(0,s.jsx)(C,{}),(0,s.jsxs)(y.UC,{ref:a,className:(0,l.cn)(D({side:t}),r),...i,children:[n,(0,s.jsxs)(y.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(w.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});R.displayName=y.UC.displayName;let A=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};A.displayName="SheetHeader";let T=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.hE,{ref:a,className:(0,l.cn)("text-lg font-semibold text-foreground",t),...r})});T.displayName=y.hE.displayName;let H=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.VY,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});H.displayName=y.VY.displayName;var S=t(7655);let I=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(S.bL,{ref:a,className:(0,l.cn)("relative overflow-hidden",t),...n,children:[(0,s.jsx)(S.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(M,{}),(0,s.jsx)(S.OK,{})]})});I.displayName=S.bL.displayName;let M=n.forwardRef((e,a)=>{let{className:t,orientation:r="vertical",...n}=e;return(0,s.jsx)(S.VM,{ref:a,orientation:r,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:(0,s.jsx)(S.lr,{className:"relative flex-1 rounded-full bg-border"})})});M.displayName=S.VM.displayName;var E=t(7489);let B=n.forwardRef((e,a)=>{let{className:t,orientation:r="horizontal",decorative:n=!0,...i}=e;return(0,s.jsx)(E.b,{ref:a,decorative:n,orientation:r,className:(0,l.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",t),...i})});B.displayName=E.b.displayName;let O="bank";var L=t(1324),P=t(2728),J=t(8718),U=t(286),F=t(8111),$=t(7723),G=t(9591);let Y=e=>{let a={className:"h-6 w-6 p-1 rounded-full"};switch(e){case"pay-bank":case"receive-from-bank":default:return(0,s.jsx)(L.A,{...a});case"repay-loan":return(0,s.jsx)(P.A,{...a});case"take-loan":return(0,s.jsx)(J.A,{...a});case"player-to-player":return(0,s.jsx)(U.A,{...a});case"pass-start":return(0,s.jsx)(F.A,{...a});case"interest-added":return(0,s.jsx)($.A,{...a})}};function V(e){let{transaction:a,currentPlayerId:t,allPlayers:r}=e,{fromId:n,toId:i,amount:o,memo:d,type:c,closingBalance:m}=a,u=n===O?{name:"Bank"}:r.find(e=>e.id===n),x=i===O?{name:"Bank"}:r.find(e=>e.id===i),f=i===t&&"interest-added"!==c&&"take-loan"!==c,p=n===t&&"repay-loan"!==c,h="text-foreground";f&&(h="text-green-600"),p&&(h="text-destructive"),("interest-added"===c||"take-loan"===c)&&(h="text-destructive"),"repay-loan"===c&&n===t&&(h="text-destructive");let g="";return"player-to-player"===c?g=n===t?"Paid ".concat(null==x?void 0:x.name):"Received from ".concat(null==u?void 0:u.name):n===O?g="Received from Bank":i===O&&(g="Paid Bank"),"pass-start"===c&&(g="Passed START"),"interest-added"===c&&(g="Loan Interest"),"take-loan"===c&&(g="Loan from Bank"),"repay-loan"===c&&(g="Repaid loan to Bank"),(0,s.jsxs)("div",{className:"flex items-start gap-4 p-2 rounded-lg hover:bg-accent",children:[(0,s.jsx)("div",{className:(0,l.cn)("rounded-full text-secondary-foreground mt-1",f?"bg-green-100 text-green-600":p?"bg-red-100 text-destructive":"bg-gray-100 text-gray-600"),children:Y(c)}),(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)("p",{className:"font-semibold",children:g}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:d})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:(0,l.cn)("font-semibold text-lg",h),children:[f?"+":p?"-":"","$",o.toLocaleString()]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1 text-xs text-muted-foreground",children:[(0,s.jsx)(G.A,{className:"h-3 w-3"}),void 0!==m&&(0,s.jsxs)("span",{children:["$",m.toLocaleString()]})]})]})]})}var z=t(5317),q=t(2400),X=t(6671);let _=e=>{let a=(0,X.useFirestore)(),t=(0,q.$e)(()=>e?(0,z.P)((0,z.rJ)(a,"games",e,"transactions"),(0,z.My)("timestamp","desc")):null,[e,a]),{data:s,isLoading:r,error:n}=(0,X.useCollection)(t);return s||[]},W=e=>{let a=(0,X.useFirestore)(),t=(0,q.$e)(()=>e?(0,z.P)((0,z.rJ)(a,"games",e,"players")):null,[e,a]),{data:s,isLoading:r,error:n}=(0,X.useCollection)(t);return s||[]};function Z(e){let{player:a,isOpen:t,onClose:l}=e,{gameId:i,userGameRole:o}=(0,r.I)(),d=_(i),c=W(i);null==o||o.role;let m=(0,n.useMemo)(()=>d?d.filter(e=>e.playerId===a.id).sort((e,a)=>{let t=e.timestamp instanceof z.Dc?e.timestamp.toMillis():new Date(e.timestamp).getTime();return(a.timestamp instanceof z.Dc?a.timestamp.toMillis():new Date(a.timestamp).getTime())-t}).reduce((e,a)=>{let t=a.round;return e[t]||(e[t]=[]),e[t].push(a),e},{}):{},[d,a.id]),u=Object.keys(m).map(Number).sort((e,a)=>a-e);return(0,s.jsx)(v,{open:t,onOpenChange:l,children:(0,s.jsxs)(R,{className:"sm:max-w-lg w-[90vw] flex flex-col",children:[(0,s.jsxs)(A,{children:[(0,s.jsxs)(T,{className:"font-headline text-2xl",children:[a.name,"'s History"]}),(0,s.jsx)(H,{children:"A log of all financial activities."})]}),(0,s.jsx)(B,{}),(0,s.jsx)(I,{className:"flex-grow",children:(0,s.jsx)("div",{className:"pr-4",children:u.length>0?u.map(e=>(0,s.jsxs)("div",{className:"my-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold font-headline text-primary mb-2 sticky top-0 bg-card/80 backdrop-blur-sm py-1",children:["Round ",e]}),(0,s.jsx)("div",{className:"space-y-3",children:m[e].map(e=>(0,s.jsx)(V,{transaction:e,currentPlayerId:a.id,allPlayers:c},e.id))})]},e)):(0,s.jsx)("div",{className:"text-center text-muted-foreground py-10",children:(0,s.jsx)("p",{children:"No transactions yet."})})})})]})})}function K(e){let{player:a,onDragStart:t,onDragEnd:r,onDrop:x,onClick:y,onPassStart:N,isDragging:w,isSelected:v,isDropTarget:k,isBanker:C}=e,[D,R]=(0,n.useState)(!1),[A,T]=(0,n.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i,{draggable:C,onClick:C?y:()=>{},onDragStart:e=>{if(!C)return void e.preventDefault();e.dataTransfer.setData("text/plain",a.id),t()},onDragEnd:r,onDragOver:e=>{e.preventDefault(),k&&C&&R(!0)},onDragLeave:()=>{R(!1)},onDrop:e=>{e.preventDefault(),C&&(R(!1),x(a.id))},className:(0,l.cn)("flex flex-col transition-all duration-200 ease-in-out shadow-lg",C&&"cursor-grab active:cursor-grabbing hover:shadow-xl",!C&&"cursor-not-allowed",w&&"opacity-50 scale-95",(D||k&&v)&&"ring-2 ring-primary ring-offset-2",v&&"shadow-2xl ring-2 ring-blue-500 ring-offset-2"),children:[(0,s.jsxs)(o,{className:"flex flex-row items-center gap-4 space-y-0 pb-2",children:[(0,s.jsxs)(f,{className:"h-16 w-16 border-2 border-primary",children:[(0,s.jsx)(p,{src:a.avatarUrl,alt:a.name,"data-ai-hint":"boardgame piece"}),(0,s.jsx)(h,{children:a.name.charAt(0)})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(d,{className:"font-headline text-2xl",children:a.name}),(0,s.jsxs)(c,{children:["Round: ",a.round]})]})]}),(0,s.jsxs)(m,{className:"flex-grow space-y-2",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Current Balance"}),(0,s.jsxs)("p",{className:"text-4xl font-bold text-primary",children:["$",a.balance.toLocaleString()]})]}),a.loan>0&&(0,s.jsxs)("div",{className:"text-center text-destructive",children:[(0,s.jsx)("p",{className:"text-sm",children:"Loan Amount"}),(0,s.jsxs)("p",{className:"text-lg font-semibold",children:["($",a.loan.toLocaleString(),")"]})]})]}),(0,s.jsxs)(u,{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)(g.$,{variant:"outline",onClick:e=>{e.stopPropagation(),T(!0)},children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," History"]}),(0,s.jsxs)(g.$,{onClick:e=>{e.stopPropagation(),N(a.id)},className:"bg-green-600 hover:bg-green-700 text-white",disabled:!C,children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Pass 'START'"]})]})]}),(0,s.jsx)(Z,{player:a,isOpen:A,onClose:()=>T(!1)})]})}var Q=t(5166);function ee(e){let{onDragStart:a,onDragEnd:t,onDrop:r,onClick:c,isDragging:u,isSelected:x,isDropTarget:f,isBanker:p}=e,[h,g]=(0,n.useState)(!1);return(0,s.jsxs)(i,{draggable:p,onClick:p?c:()=>{},onDragStart:e=>{if(!p)return void e.preventDefault();e.dataTransfer.setData("text/plain",O),a()},onDragEnd:t,onDragOver:e=>{e.preventDefault(),f&&p&&g(!0)},onDragLeave:()=>{g(!1)},onDrop:e=>{e.preventDefault(),p&&(g(!1),r(O))},className:(0,l.cn)("flex flex-col items-center justify-center text-center p-6 bg-secondary transition-shadow duration-200 ease-in-out shadow-lg",p&&"cursor-grab active:cursor-grabbing hover:shadow-xl",!p&&"cursor-not-allowed",(h||f&&x)&&"ring-2 ring-primary ring-offset-2",u&&"opacity-50",x&&"shadow-2xl ring-2 ring-blue-500 ring-offset-2"),children:[(0,s.jsx)(o,{className:"p-0",children:(0,s.jsx)(Q.A,{className:"h-20 w-20 text-primary"})}),(0,s.jsx)(m,{className:"p-0 mt-4",children:(0,s.jsx)(d,{className:"font-headline text-3xl",children:"The Bank"})})]})}var ea=t(2177),et=t(221),es=t(5594);let er=y.bL;y.l9;let en=y.ZL;y.bm;let el=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.hJ,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});el.displayName=y.hJ.displayName;let ei=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(en,{children:[(0,s.jsx)(el,{}),(0,s.jsxs)(y.UC,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[r,(0,s.jsxs)(y.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(w.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ei.displayName=y.UC.displayName;let eo=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};eo.displayName="DialogHeader";let ed=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};ed.displayName="DialogFooter";let ec=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.hE,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});ec.displayName=y.hE.displayName;let em=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(y.VY,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});em.displayName=y.VY.displayName;var eu=t(4253),ex=t(968);let ef=(0,N.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ep=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(ex.b,{ref:a,className:(0,l.cn)(ef(),t),...r})});ep.displayName=ex.b.displayName;let eh=ea.Op,eg=n.createContext({}),ej=e=>{let{...a}=e;return(0,s.jsx)(eg.Provider,{value:{name:a.name},children:(0,s.jsx)(ea.xI,{...a})})},eb=()=>{let e=n.useContext(eg),a=n.useContext(ey),{getFieldState:t,formState:s}=(0,ea.xW)(),r=t(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=a;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...r}},ey=n.createContext({}),eN=n.forwardRef((e,a)=>{let{className:t,...r}=e,i=n.useId();return(0,s.jsx)(ey.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:a,className:(0,l.cn)("space-y-2",t),...r})})});eN.displayName="FormItem";let ew=n.forwardRef((e,a)=>{let{className:t,...r}=e,{error:n,formItemId:i}=eb();return(0,s.jsx)(ep,{ref:a,className:(0,l.cn)(n&&"text-destructive",t),htmlFor:i,...r})});ew.displayName="FormLabel";let ev=n.forwardRef((e,a)=>{let{...t}=e,{error:r,formItemId:n,formDescriptionId:l,formMessageId:i}=eb();return(0,s.jsx)(eu.DX,{ref:a,id:n,"aria-describedby":r?"".concat(l," ").concat(i):"".concat(l),"aria-invalid":!!r,...t})});ev.displayName="FormControl",n.forwardRef((e,a)=>{let{className:t,...r}=e,{formDescriptionId:n}=eb();return(0,s.jsx)("p",{ref:a,id:n,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})}).displayName="FormDescription";let ek=n.forwardRef((e,a)=>{var t;let{className:r,children:n,...i}=e,{error:o,formMessageId:d}=eb(),c=o?String(null!=(t=null==o?void 0:o.message)?t:""):n;return c?(0,s.jsx)("p",{ref:a,id:d,className:(0,l.cn)("text-sm font-medium text-destructive",r),...i,children:c}):null});ek.displayName="FormMessage";let eC=n.forwardRef((e,a)=>{let{className:t,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...n})});eC.displayName="Input";var eD=t(6768),eR=t(9556),eA=t(7381),eT=t(518);let eH=eD.bL;eD.YJ;let eS=eD.WT,eI=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(eD.l9,{ref:a,className:(0,l.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,s.jsx)(eD.In,{asChild:!0,children:(0,s.jsx)(eR.A,{className:"h-4 w-4 opacity-50"})})]})});eI.displayName=eD.l9.displayName;let eM=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(eD.PP,{ref:a,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(eA.A,{className:"h-4 w-4"})})});eM.displayName=eD.PP.displayName;let eE=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(eD.wn,{ref:a,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(eR.A,{className:"h-4 w-4"})})});eE.displayName=eD.wn.displayName;let eB=n.forwardRef((e,a)=>{let{className:t,children:r,position:n="popper",...i}=e;return(0,s.jsx)(eD.ZL,{children:(0,s.jsxs)(eD.UC,{ref:a,className:(0,l.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[(0,s.jsx)(eM,{}),(0,s.jsx)(eD.LM,{className:(0,l.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(eE,{})]})})});eB.displayName=eD.UC.displayName,n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(eD.JU,{ref:a,className:(0,l.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=eD.JU.displayName;let eO=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(eD.q7,{ref:a,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(eD.VF,{children:(0,s.jsx)(eT.A,{className:"h-4 w-4"})})}),(0,s.jsx)(eD.p4,{children:r})]})});eO.displayName=eD.q7.displayName,n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(eD.wv,{ref:a,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=eD.wv.displayName;let eL=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...r})});eL.displayName="Textarea";let eP=es.Ik({amount:es.au.number().positive("Amount must be positive."),memo:es.Yj().optional(),type:es.Yj().min(1,"Transaction type is required.")}),eJ=(e,a)=>e!==O&&a===O?[{value:"pay-bank",label:"Pay Bank (e.g., Property)"},{value:"repay-loan",label:"Repay Loan"}]:e===O&&a!==O?[{value:"receive-from-bank",label:"Receive from Bank (e.g., Chance)"},{value:"take-loan",label:"Take Loan"}]:e!==O&&a!==O?[{value:"player-to-player",label:"Player-to-Player Transfer"}]:[];function eU(e){let{isOpen:a,onClose:t,source:r,destination:l,onConfirm:i}=e,o=(0,n.useRef)(null),d="bank"===r?O:null==r?void 0:r.id,c="bank"===l?O:null==l?void 0:l.id,m=(0,n.useMemo)(()=>d&&c?eJ(d,c):[],[d,c]),u=(0,n.useMemo)(()=>{if(d&&c){if(d!==O&&c===O)return"pay-bank";if(d===O&&c!==O)return"receive-from-bank";if(1===m.length)return m[0].value}},[d,c,m]),x=(0,ea.mN)({resolver:(0,et.u)(eP),defaultValues:{amount:0,memo:""}});(0,n.useEffect)(()=>{if(a){x.reset({amount:0,memo:"",type:u});let e=setTimeout(()=>{var e,a;null==(e=o.current)||e.focus(),null==(a=o.current)||a.select()},100);return()=>clearTimeout(e)}},[a,u,x]);let f="bank"===r?"Bank":null==r?void 0:r.name,p="bank"===l?"Bank":null==l?void 0:l.name;return(0,s.jsx)(er,{open:a,onOpenChange:t,children:(0,s.jsxs)(ei,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(eo,{children:[(0,s.jsx)(ec,{className:"font-headline text-2xl",children:"New Transaction"}),(0,s.jsxs)(em,{children:["From ",(0,s.jsx)("span",{className:"font-bold text-primary",children:f})," to ",(0,s.jsx)("span",{className:"font-bold text-primary",children:p})]})]}),(0,s.jsx)(eh,{...x,children:(0,s.jsxs)("form",{onSubmit:x.handleSubmit(e=>{d&&c&&(i({fromId:d,toId:c,amount:e.amount,memo:e.memo||"Transaction",type:e.type}),t())}),className:"space-y-4",children:[(0,s.jsx)(ej,{control:x.control,name:"type",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"Type"}),(0,s.jsxs)(eH,{onValueChange:a.onChange,value:a.value,defaultValue:a.value,children:[(0,s.jsx)(ev,{children:(0,s.jsx)(eI,{children:(0,s.jsx)(eS,{placeholder:"Select transaction type"})})}),(0,s.jsx)(eB,{children:m.map(e=>(0,s.jsx)(eO,{value:e.value,children:e.label},e.value))})]}),(0,s.jsx)(ek,{})]})}}),(0,s.jsx)(ej,{control:x.control,name:"amount",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"Amount ($)"}),(0,s.jsx)(ev,{children:(0,s.jsx)(eC,{type:"number",...a,ref:o})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsx)(ej,{control:x.control,name:"memo",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"Memo (Optional)"}),(0,s.jsx)(ev,{children:(0,s.jsx)(eL,{placeholder:"e.g., Rent for Boardwalk",...a})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsxs)(ed,{children:[(0,s.jsx)(g.$,{type:"button",variant:"ghost",onClick:t,children:"Cancel"}),(0,s.jsx)(g.$,{type:"submit",children:"Confirm Transaction"})]})]})})]})})}let eF=(0,N.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),e$=n.forwardRef((e,a)=>{let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{ref:a,role:"alert",className:(0,l.cn)(eF({variant:r}),t),...n})});e$.displayName="Alert";let eG=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h5",{ref:a,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",t),...r})});eG.displayName="AlertTitle";let eY=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",t),...r})});eY.displayName="AlertDescription";var eV=t(5599),ez=t(4843),eq=t(3349),eX=t(7481);let e_=(0,N.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function eW(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)(e_({variant:t}),a),...r})}function eZ(){let e=(0,X.useFirestore)(),{gameId:a}=(0,r.I)(),[t,l]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!a)return;let t=(0,z.rJ)(e,"games",a,"userGameRoles"),s=(0,z.aQ)(t,e=>{l(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()},[a,e]);let i=t.filter(e=>"Banker"===e.role).length,o=t.filter(e=>"Viewer"===e.role).length;return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(U.A,{className:"h-4 w-4"}),(0,s.jsxs)(eW,{variant:"outline",children:["Bankers: ",i]}),(0,s.jsxs)(eW,{variant:"outline",children:["Viewers: ",o]})]})}var eK=t(7250);let eQ=eK.bL,e0=n.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(eK.q7,{ref:a,className:(0,l.cn)("border-b",t),...r})});e0.displayName="AccordionItem";let e1=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsx)(eK.Y9,{className:"flex",children:(0,s.jsxs)(eK.l9,{ref:a,className:(0,l.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...n,children:[r,(0,s.jsx)(eR.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});e1.displayName=eK.l9.displayName;let e2=n.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsx)(eK.UC,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,s.jsx)("div",{className:(0,l.cn)("pb-4 pt-0",t),children:r})})});e2.displayName=eK.UC.displayName;var e4=t(1550);function e5(){let{game:e}=(0,r.I)();if(!e)return null;let{passStartAmount:a,loanInterestRate:t}=e;return(0,s.jsx)(eQ,{type:"single",collapsible:!0,className:"w-full mb-8",children:(0,s.jsxs)(e0,{value:"item-1",children:[(0,s.jsx)(e1,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(e4.A,{className:"h-5 w-5"}),(0,s.jsx)("h2",{className:"text-xl font-headline",children:"Game Rulebook"})]})}),(0,s.jsx)(e2,{children:(0,s.jsx)("div",{className:"space-y-4 text-muted-foreground p-4 bg-secondary/30 rounded-lg",children:(0,s.jsxs)("div",{className:"prose",children:[(0,s.jsx)("h3",{className:"font-semibold text-foreground",children:"Passing 'START'"}),(0,s.jsxs)("p",{children:["Each time a player passes 'START', they will receive ",(0,s.jsxs)("strong",{children:["$",a.toLocaleString()]})," from the bank."]}),(0,s.jsx)("h3",{className:"font-semibold text-foreground",children:"Loan Interest"}),(0,s.jsxs)("p",{children:["If a player has an outstanding loan balance when they pass 'START', an interest of ",(0,s.jsxs)("strong",{children:[100*t,"%"]})," will be added to their loan amount."]}),(0,s.jsx)("h3",{className:"font-semibold text-foreground",children:"Transactions"}),(0,s.jsx)("p",{children:"Only the Banker can perform transactions. This includes player-to-player payments, payments to/from the bank, and managing loans."}),(0,s.jsx)("h3",{className:"font-semibold text-foreground",children:"Loan Payment rule"}),(0,s.jsx)("p",{children:"Remember to transfer the loan amount taken from the bank to the same Bank for purchasing any property owned or in control of the bank. this is recurring process since the game only has one bank unlike real world where the loan amount gets transfered to different accounts."})]})})})]})})}var e8=t(8271),e3=t(9119);let e6=es.Ik({passStartAmount:es.au.number().min(0,"Must be a positive number."),loanInterestRate:es.au.number().min(0,"Must be 0 or greater.").max(1,"Must be between 0 and 1 (e.g., 0.1 for 10%).")});function e9(){let{game:e,updateGameSettings:a}=(0,r.I)(),{toast:t}=(0,eX.dj)(),l=(0,ea.mN)({resolver:(0,et.u)(e6),defaultValues:{passStartAmount:(null==e?void 0:e.passStartAmount)||2e3,loanInterestRate:(null==e?void 0:e.loanInterestRate)||.1}});(0,n.useEffect)(()=>{e&&l.reset({passStartAmount:e.passStartAmount,loanInterestRate:e.loanInterestRate})},[e,l]);let u=async e=>{try{await a(e),t({title:"Settings Saved",description:"The game rules have been updated."})}catch(e){t({variant:"destructive",title:"Save Failed",description:"Could not save settings."})}};return e?(0,s.jsxs)(i,{className:"w-full mb-8 shadow-md",children:[(0,s.jsxs)(o,{children:[(0,s.jsxs)(d,{className:"flex items-center gap-2",children:[(0,s.jsx)(e8.A,{})," Banker Controls"]}),(0,s.jsx)(c,{children:"Adjust core game rules. Changes will apply immediately."})]}),(0,s.jsx)(m,{children:(0,s.jsx)(eh,{...l,children:(0,s.jsxs)("form",{onSubmit:l.handleSubmit(u),className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-end",children:[(0,s.jsx)(ej,{control:l.control,name:"passStartAmount",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"'Pass START' Amount ($)"}),(0,s.jsx)(ev,{children:(0,s.jsx)(eC,{type:"number",...a})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsx)(ej,{control:l.control,name:"loanInterestRate",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"Loan Interest Rate (e.g., 0.1 for 10%)"}),(0,s.jsx)(ev,{children:(0,s.jsx)(eC,{type:"number",step:"0.01",...a})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsxs)(g.$,{type:"submit",className:"font-bold w-full md:w-auto",children:[(0,s.jsx)(e3.A,{className:"mr-2"})," Save Settings"]})]})})})]}):null}var e7=t(3310),ae=t(610);let aa=(e,a,t,s,r,n)=>{let l={...r,timestamp:(0,z.O5)(),playerId:s.id,round:s.round,closingBalance:n},i=(0,z.H9)((0,z.rJ)(a,"games",t,"transactions"));e.set(i,l)},at=async(e,a,t)=>{try{if(t.fromId!==O){let s=(0,z.H9)(e,"games",a,"players",t.fromId),r=await (0,z.x7)(s);if(r.exists()){let e=r.data();if(e.balance<t.amount)throw console.log("Insufficient funds: ".concat(e.name||t.fromId," has only $").concat(e.balance,".")),Error("Insufficient funds: ".concat(e.name||t.fromId," has only $").concat(e.balance,"."))}}let s=(0,z.wP)(e);return await (0,z.c4)(e,async r=>{let{fromId:n,toId:l,amount:i,type:o,memo:d}=t,c=n!==O?(0,z.H9)(e,"games",a,"players",n):null,m=l!==O?(0,z.H9)(e,"games",a,"players",l):null,u=c?await r.get(c):null,x=m?await r.get(m):null,f=(null==u?void 0:u.exists())?u.data():null,p=(null==x?void 0:x.exists())?x.data():null;if("player-to-player"===o&&f&&f.balance<i||"pay-bank"===o&&f&&f.balance<i||"repay-loan"===o&&f&&f.balance<i)throw Error("Insufficient funds: ".concat(f.name," has only $").concat(f.balance,"."));switch(o){case"player-to-player":if(f&&p&&c&&m){if(f.balance<i)throw Error("".concat(f.name," has insufficient funds."));r.update(c,{balance:f.balance-i}),r.update(m,{balance:p.balance+i}),aa(s,e,a,{...f,id:n},{fromId:n,toId:l,amount:i,type:o,memo:d},f.balance-i),aa(s,e,a,{...p,id:l},{fromId:n,toId:l,amount:i,type:o,memo:d},p.balance+i)}break;case"pay-bank":if(f&&c){if(f.balance<i)throw Error("".concat(f.name," has insufficient funds."));r.update(c,{balance:f.balance-i}),aa(s,e,a,{...f,id:n},{fromId:n,toId:l,amount:i,type:o,memo:d},f.balance-i)}break;case"repay-loan":if(f&&c){let t=Math.min(i,f.loan);if(f.balance<t)throw Error("".concat(f.name," has insufficient funds to repay ").concat(t,"."));r.update(c,{balance:f.balance-t,loan:f.loan-t}),aa(s,e,a,{...f,id:n},{fromId:n,toId:l,amount:t,type:o,memo:d},f.balance-t)}break;case"receive-from-bank":p&&m&&(r.update(m,{balance:p.balance+i}),aa(s,e,a,{...p,id:l},{fromId:n,toId:l,amount:i,type:o,memo:d},p.balance+i));break;case"take-loan":p&&m&&(r.update(m,{balance:p.balance+i,loan:p.loan+i}),aa(s,e,a,{...p,id:l},{fromId:n,toId:l,amount:i,type:o,memo:d},p.balance+i))}}),await s.commit(),!0}catch(e){if(console.error("Transaction error in performTransaction:",e),e.code&&e.code.includes("permission-denied")){let e=new ae.$({path:"games/".concat(a,"/players"),operation:"write",requestResourceData:t});e7.d.emit("permission-error",e)}throw e}},as=async(e,a,t,s,r)=>{try{let n=(0,z.wP)(e);await (0,z.c4)(e,async l=>{let i=(0,z.H9)(e,"games",a,"players",t),o=await l.get(i);if(!o.exists())throw Error("Player not found.");let d=o.data(),c=d.round+1,m=d.balance+s,u=d.loan;if(aa(n,e,a,{...d,id:t},{fromId:O,toId:t,amount:s,type:"pass-start",memo:"Passed START"},m),d.loan>0){let s=Math.round(d.loan*r);u+=s,aa(n,e,a,{...d,id:t},{fromId:O,toId:t,amount:s,type:"interest-added",memo:"".concat(100*r,"% interest on loan")},m)}l.update(i,{round:c,balance:m,loan:u})}),await n.commit()}catch(s){let e=new ae.$({path:"games/".concat(a,"/players/").concat(t),operation:"update"});throw e7.d.emit("permission-error",e),s}};function ar(){let{game:e,userGameRole:a,exitGame:t,gameId:l}=(0,r.I)(),i=(0,X.useFirestore)(),o=W(l),[d,c]=(0,n.useState)(null),[m,u]=(0,n.useState)(null),[x,f]=(0,n.useState)({isOpen:!1,source:null,destination:null}),{toast:p}=(0,eX.dj)(),h=function(){let[e,a]=n.useState(void 0);return n.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),t=()=>{a(window.innerWidth<768)};return e.addEventListener("change",t),a(window.innerWidth<768),()=>e.removeEventListener("change",t)},[]),!!e}(),j=(null==a?void 0:a.role)==="Banker",b=e=>{j&&c(e)},y=()=>{j&&c(null)},N=(e,a)=>{if(!j||e===a)return;let t=e===O?"bank":o.find(a=>a.id===e),s=a===O?"bank":o.find(e=>e.id===a);t&&s&&f({isOpen:!0,source:t,destination:s})},w=e=>{j&&d&&N(d,e)},v=e=>{h&&j&&(m?(N(m,e),u(null)):u(e))},k=async e=>{if(i&&l)try{await at(i,l,e),p({title:"Transaction Successful",description:"Financial records updated."})}catch(e){console.error("Transaction error:",e),p({variant:"destructive",title:"Transaction Failed",description:e.message||"Unable to complete transaction. Please try again."})}},C=async a=>{if(i&&l&&e)try{await as(i,l,a,e.passStartAmount,e.loanInterestRate);let t=o.find(e=>e.id===a);p({title:"".concat(null==t?void 0:t.name," Passed START!"),description:"Balance and round updated."})}catch(e){p({variant:"destructive",title:"Action Failed",description:e.message})}};return(0,s.jsxs)("div",{className:"container mx-auto p-4 min-h-screen",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-5xl font-headline text-primary",children:"BizFlow"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"A Digital Ledger for the Business Board Game"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eZ,{}),(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{(null==e?void 0:e.gameCode)&&(navigator.clipboard.writeText(e.gameCode),p({title:"Game Code Copied!",description:'You can now share "'.concat(e.gameCode,'" with other players.')}))},children:[(0,s.jsx)(eV.A,{className:"mr-2"})," ",null==e?void 0:e.gameCode]})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["You are a ",(0,s.jsx)("span",{className:j?"font-bold text-primary":"font-bold",children:null==a?void 0:a.role})]})]})]}),(0,s.jsx)(e5,{}),j&&(0,s.jsx)(e9,{}),(0,s.jsxs)("p",{className:"text-center text-muted-foreground mb-8",children:[j&&(h?"Tap a card to select a source, then tap another for the destination.":"Drag and drop cards to make transactions."),!j&&"You are in Viewer Mode. No changes can be made."]}),h&&m&&j&&(0,s.jsxs)(e$,{className:"mb-4 max-w-md mx-auto bg-accent border-primary text-primary",children:[(0,s.jsx)(ez.A,{className:"h-4 w-4"}),(0,s.jsx)(eG,{className:"font-semibold",children:"Source Selected!"}),(0,s.jsx)(eY,{children:"Now tap a destination card to complete the transfer."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,s.jsx)(ee,{onDragStart:()=>b(O),onDragEnd:y,onDrop:w,onClick:()=>v(O),isDragging:d===O,isSelected:m===O,isDropTarget:!!(d||m)&&d!==O&&m!==O,isBanker:j}),o.map(e=>(0,s.jsx)(K,{player:e,onDragStart:()=>b(e.id),onDragEnd:y,onDrop:w,onClick:()=>v(e.id),onPassStart:C,isDragging:d===e.id,isSelected:m===e.id,isDropTarget:!!(d||m)&&d!==e.id&&m!==e.id,isBanker:j},e.id))]}),(0,s.jsx)("div",{className:"absolute bottom-4 right-4",children:j?(0,s.jsx)(g.$,{variant:"destructive",size:"sm",onClick:t,children:"End Game"}):(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:t,children:[(0,s.jsx)(eq.A,{className:"mr-2"})," Exit Game"]})}),j&&(0,s.jsx)(eU,{isOpen:x.isOpen,onClose:()=>{f({isOpen:!1,source:null,destination:null}),u(null)},source:x.source,destination:x.destination,onConfirm:k})]})}var an=t(7223),al=t(3896);let ai=JSON.parse('{"o":[{"id":"avatar1","description":"Top Hat","imageUrl":"https://images.unsplash.com/photo-1662137897341-4626aed88c1d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwxfHx0b3AlMjBoYXR8ZW58MHx8fHwxNzU5NDYwNjY0fDA&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"top hat"},{"id":"avatar2","description":"Race Car","imageUrl":"https://images.unsplash.com/photo-1617137555671-e5edec6e666b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw0fHxyYWNlJTIwY2FyfGVufDB8fHx8MTc1OTQ2NjcxMnww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"race car"},{"id":"avatar3","description":"Battleship","imageUrl":"https://images.unsplash.com/photo-1562180410-ef466ed2c548?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwzfHxiYXR0bGVzaGlwfGVufDB8fHx8MTc1OTU1ODUwNXww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"battleship"},{"id":"avatar4","description":"Scottie Dog","imageUrl":"https://images.unsplash.com/photo-1691564808249-33654b07aef5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw0fHxzY290dGllJTIwZG9nfGVufDB8fHx8MTc1OTU1ODUwNXww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"scottie dog"},{"id":"avatar5","description":"Thimble","imageUrl":"https://images.unsplash.com/photo-1747927339115-da8f8680a594?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw1fHx0aGltYmxlfGVufDB8fHx8MTc1OTU1ODUwNXww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"thimble"},{"id":"avatar6","description":"Wheelbarrow","imageUrl":"https://images.unsplash.com/photo-1715274036728-4385d95a5e9f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw0fHx3aGVlbGJhcnJvd3xlbnwwfHx8fDE3NTk1NTg1MDV8MA&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"wheelbarrow"},{"id":"avatar7","description":"Iron","imageUrl":"https://images.unsplash.com/photo-1528918652533-dfdb3f368093?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxpcm9ufGVufDB8fHx8MTc1OTU1ODUwNXww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"iron"},{"id":"avatar8","description":"Boot","imageUrl":"https://images.unsplash.com/photo-1608256246200-53e635b5b65f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwxfHxib290fGVufDB8fHx8MTc1OTUwODE2N3ww&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"boot"}]}').o,ao=es.Ik({initialCapital:es.au.number().min(1,"Initial capital must be positive."),players:es.YO(es.Ik({name:es.Yj().min(1,"Player name is required.")})).min(2,"At least 2 players are required.").max(8,"A maximum of 8 players are allowed.")});function ad(){let{game:e}=(0,r.I)(),a=(0,X.useFirestore)(),{toast:t}=(0,eX.dj)(),n=(0,ea.mN)({resolver:(0,et.u)(ao),defaultValues:{initialCapital:(null==e?void 0:e.initialCapital)||15e3,players:[{name:""},{name:""}]}}),{fields:l,append:u,remove:x}=(0,ea.jz)({control:n.control,name:"players"}),f=async s=>{if(!a||!(null==e?void 0:e.id))return void t({variant:"destructive",title:"Error",description:"Game not properly initialized."});let r=(0,z.wP)(a),n=(0,z.H9)(a,"games",e.id);r.update(n,{gameStarted:!0,initialCapital:s.initialCapital});let l=(0,z.rJ)(a,"games",e.id,"players");s.players.forEach((e,a)=>{let t=(0,z.H9)(l),n={name:e.name,balance:s.initialCapital,loan:0,round:1,avatarUrl:ai[a%ai.length].imageUrl};r.set(t,n)});try{await r.commit(),t({title:"Game Started!",description:"All players have been created."})}catch(r){let a=new ae.$({path:"games/".concat(e.id),operation:"write",requestResourceData:{gameStarted:!0,initialCapital:s.initialCapital,players:s.players}});e7.d.emit("permission-error",a),t({variant:"destructive",title:"Error",description:"Could not start game."})}};return(0,s.jsxs)(i,{className:"w-full max-w-md mx-auto shadow-2xl",children:[(0,s.jsxs)(o,{className:"text-center",children:[(0,s.jsx)(Q.A,{className:"mx-auto h-12 w-12 text-primary"}),(0,s.jsx)(d,{className:"font-headline text-4xl",children:"Game Setup"}),(0,s.jsx)(c,{children:"Configure the players and starting money."})]}),(0,s.jsx)(m,{children:(0,s.jsx)(eh,{...n,children:(0,s.jsxs)("form",{onSubmit:n.handleSubmit(f),className:"space-y-6",children:[(0,s.jsx)(ej,{control:n.control,name:"initialCapital",render:e=>{let{field:a}=e;return(0,s.jsxs)(eN,{children:[(0,s.jsx)(ew,{children:"Initial Capital ($)"}),(0,s.jsx)(ev,{children:(0,s.jsx)(eC,{type:"number",...a})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(ep,{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(U.A,{className:"h-4 w-4"})," Players"]}),(0,s.jsx)("div",{className:"space-y-3",children:l.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ej,{control:n.control,name:"players.".concat(a,".name"),render:e=>{let{field:t}=e;return(0,s.jsxs)(eN,{className:"flex-grow",children:[(0,s.jsx)(ev,{children:(0,s.jsx)(eC,{placeholder:"Player ".concat(a+1," Name"),...t})}),(0,s.jsx)(ek,{})]})}}),(0,s.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(a),disabled:l.length<=2,"aria-label":"Remove player",children:(0,s.jsx)(an.A,{className:"h-4 w-4 text-destructive"})})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)(g.$,{type:"button",variant:"outline",onClick:()=>u({name:""}),disabled:l.length>=8,children:[(0,s.jsx)(al.A,{className:"mr-2 h-4 w-4"})," Add Player"]}),(0,s.jsx)(g.$,{type:"submit",className:"font-bold",children:"Start Game"})]})]})})})]})}function ac(){let{game:e,userGameRole:a,players:t,exitGame:n}=(0,r.I)(),{toast:l}=(0,eX.dj)(),u=(null==a?void 0:a.role)==="Banker";return e?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:(0,s.jsxs)(i,{className:"w-full max-w-lg mx-auto shadow-2xl text-center",children:[(0,s.jsxs)(o,{children:[(0,s.jsx)(Q.A,{className:"mx-auto h-12 w-12 text-primary"}),(0,s.jsx)(d,{className:"font-headline text-4xl",children:"Game Lobby"}),(0,s.jsx)(c,{children:"Waiting for the Banker to start the game."})]}),(0,s.jsxs)(m,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,s.jsx)("p",{className:"text-2xl font-mono p-3 bg-muted rounded-md tracking-widest",children:e.gameCode}),(0,s.jsx)(g.$,{variant:"outline",size:"icon",onClick:()=>{(null==e?void 0:e.gameCode)&&(navigator.clipboard.writeText(e.gameCode),l({title:"Game Code Copied!",description:'You can now share "'.concat(e.gameCode,'" with other players.')}))},children:(0,s.jsx)(eV.A,{})})]}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-2",children:[(0,s.jsx)(U.A,{})," Players in Lobby"]}),(0,s.jsx)(eZ,{})]}),u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ad,{}),(0,s.jsx)(g.$,{variant:"destructive",size:"sm",onClick:n,children:"End Game"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-muted-foreground p-4 bg-accent rounded-md",children:"Once the Banker starts the game, the player dashboard will appear here."}),(0,s.jsxs)(g.$,{variant:"outline",onClick:n,children:[(0,s.jsx)(eq.A,{className:"mr-2"})," Exit Lobby"]})]})]})]})}):(0,s.jsx)("div",{children:"Loading..."})}function am(){let{game:e,loading:a,exitGame:t}=(0,r.I)();return a?(0,s.jsx)("div",{className:"flex h-screen w-screen items-center justify-center bg-background",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(Q.A,{className:"mx-auto h-16 w-16 text-primary animate-pulse"}),(0,s.jsx)("h1",{className:"mt-4 text-4xl font-headline text-primary",children:"BizFlow"}),(0,s.jsx)("p",{className:"text-muted-foreground animate-pulse",children:"Loading your game..."})]})}):e?(0,s.jsx)("div",{className:"relative min-h-screen",children:e.gameStarted?(0,s.jsx)(ar,{}):(0,s.jsx)(ac,{})}):(0,s.jsx)("div",{className:"flex h-screen w-screen items-center justify-center bg-background",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(Q.A,{className:"mx-auto h-16 w-16 text-destructive"}),(0,s.jsx)("h1",{className:"mt-4 text-4xl font-headline text-destructive",children:"Error"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Could not load game data."}),(0,s.jsx)(g.$,{onClick:t,className:"mt-4",children:"Go Home"})]})})}var au=t(3004);function ax(){let{gameId:e,createGame:a,joinGame:t,error:l}=(0,r.I)(),[u,x]=(0,n.useState)(""),{user:f,isUserLoading:p}=(0,X.useUser)(),h=(0,X.useAuth)();return((0,n.useEffect)(()=>{p||f||(0,au.zK)(h).catch(e=>{console.error("Anonymous sign-in failed:",e)})},[p,f,h]),e)?(0,s.jsx)("main",{children:(0,s.jsx)(am,{})}):(0,s.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center bg-background p-8",children:(0,s.jsxs)(i,{className:"w-full max-w-md shadow-2xl",children:[(0,s.jsxs)(o,{className:"text-center",children:[(0,s.jsx)(Q.A,{className:"mx-auto h-12 w-12 text-primary"}),(0,s.jsx)(d,{className:"font-headline text-4xl",children:"BizFlow"}),(0,s.jsx)(c,{children:"The Digital Ledger for Business"})]}),(0,s.jsxs)(m,{className:"space-y-6",children:[(0,s.jsx)(g.$,{onClick:a,className:"w-full font-bold",disabled:p||!f,children:p||!f?"Connecting...":"Create New Game"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("hr",{className:"w-full"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"OR"}),(0,s.jsx)("hr",{className:"w-full"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eC,{type:"text",placeholder:"Enter Game Code (e.g., BIZ-ABCD)",value:u,onChange:e=>x(e.target.value.toUpperCase()),className:"text-center"}),(0,s.jsx)(g.$,{onClick:()=>{u&&t(u)},variant:"secondary",className:"w-full",disabled:!u||p||!f,children:"Join Game"})]}),l&&(0,s.jsx)("p",{className:"text-destructive text-center",children:l})]})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,644,158,931,383,441,684,358],()=>a(3223)),_N_E=e.O()}]);